var db_QR_name='qr_his';function dbInitialize(){var db_QR=Ti.Database.open(db_QR_name);db_QR.execute('CREATE TABLE IF NOT EXISTS QRHISTORY (QRFILENAME TEXT, URL TEXT , DESC TEXT);');db_QR.execute('CREATE INDEX IF NOT EXISTS QRFILENAME ON QRHISTORY(QRFILENAME ASC);');db_QR.close();};function getQRDesc(QR_filename){var db_QR=Ti.Database.open(db_QR_name);var rows=db_QR.execute('SELECT * FROM QRHISTORY WHERE (QRFILENAME = ?);',QR_filename);Ti.API.info('Price Data COUNT = '+rows.getRowCount());var QR_Desc='';if(rows.isValidRow()){Ti.API.info('QR_filename: '+rows.fieldByName('QRFILENAME')+' URL: '+rows.fieldByName('URL')+' DESC: '+rows.fieldByName('DESC'));QR_Desc=rows.fieldByName('DESC');}else{QR_Desc='';};db_QR.close();return QR_Desc}
function getQRLink(QR_filename){var db_QR=Ti.Database.open(db_QR_name);Ti.API.info('QRFILENAME:',QR_filename)
var rows=db_QR.execute('SELECT * FROM QRHISTORY WHERE (QRFILENAME = ?);',QR_filename);var QR_Link=''
if(rows.isValidRow()){Ti.API.info('QR_filename: '+rows.fieldByName('QRFILENAME')+' URL: '+rows.fieldByName('URL')+' DESC: '+rows.fieldByName('DESC'));QR_Link=rows.fieldByName('URL');}else{QR_Link='';};db_QR.close();return QR_Link;}
function buildQRDesc(QR_filename,QR_link,QR_desc){var db_QR=Ti.Database.open(db_QR_name);if(QR_desc=undefined){QR_desc='';}
var rows=db_QR.execute('INSERT INTO QRHISTORY VALUES(?,?,?);',QR_filename,QR_link,QR_desc);db_QR.close();}
function showIndicator(indMsg){if(Ti.Platform.osname!='android'){indWin=Ti.UI.createWindow({height:150,width:200,left:60});var indView=Ti.UI.createView({height:150,width:200,backgroundColor:'#000',borderRadius:10,opacity:0.6});indWin.add(indView);}
actInd=Ti.UI.createActivityIndicator({style:Ti.UI.iPhone.ActivityIndicatorStyle.BIG,height:50,width:50});if(Ti.Platform.osname!='android'){indWin.add(actInd);var message=Ti.UI.createLabel({text:indMsg,color:'#fff',width:'auto',height:'auto',font:{fontSize:20,fontWeight:'bold'},bottom:20});indWin.add(message);indWin.open();}else{actInd.message=indMsg;}
actInd.show();}
function hideIndicator(){actInd.hide()
if(Ti.Platform.osname!='android'){indWin.close({opacity:0,duration:500});}}
function show_links(url_Link){var win_link=Ti.UI.createWindow({title:'QR Contents',barColor:'#222',backgroundColor:'#333',navBarHidden:false})
win_link.navBarHidden=(Ti.Platform.osname==='android')?true:false;var btn_closeWinLink=Ti.UI.createButton({title:'close'});btn_closeWinLink.addEventListener('click',function(){win_link.close()})
win_link.leftNavButton=btn_closeWinLink
var webview_link=Ti.UI.createWebView({url:url_Link})
webview_link.addEventListener('load',function(){hideIndicator()})
win_link.add(webview_link)
var flexSpace=Ti.UI.createButton({systemButton:Ti.UI.iPhone.SystemButton.FLEXIBLE_SPACE});var bb_back=Ti.UI.createButton({image:'image/toolbar_leftarrow.png'});bb_back.addEventListener('click',function(){webview_link.goBack();})
var bb_forward=Ti.UI.createButton({image:'image/toolbar_rightarrow.png'});bb_forward.addEventListener('click',function(){webview_link.goForward();})
var bb_reload=Ti.UI.createButton({image:'image/toolbar_refresh.png'});bb_reload.addEventListener('click',function(){webview_link.reload();})
win_link.setToolbar([flexSpace,bb_back,flexSpace,bb_reload,flexSpace,bb_forward,flexSpace]);showIndicator('Loading...')
if(Ti.Platform.osname=='android'){win_link.open({transition:Ti.UI.iPhone.AnimationStyle.FLIP_FROM_RIGHT});}else{win_link.open({modal:true});}}