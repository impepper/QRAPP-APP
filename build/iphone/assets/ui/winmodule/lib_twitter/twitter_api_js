var path_lib='';if(Ti.Platform.osname=='iphone'&&Ti.version<'1.7.0'){path_lib='/lib/';}
Ti.include(path_lib+'sha1.js');Ti.include(path_lib+'oauth.js');Ti.include(path_lib+'oauth_adapter.js');var TwitterApi=function(params){var self=this;var consumerSecret=params.consumerSecret;var consumerKey=params.consumerKey;var signatureMethod=params.signatureMethod||'HMAC-SHA1';this.oAuthAdapter=new OAuthAdapter(consumerSecret,consumerKey,signatureMethod,{useQueue:false});this.init=function(params){var oAuthAdapter=this.oAuthAdapter;oAuthAdapter.loadAccessToken('twitter');if(oAuthAdapter.isAuthorized()==false){var receivePin=function(){oAuthAdapter.getAccessToken('https://api.twitter.com/oauth/access_token',function(){oAuthAdapter.saveAccessToken('twitter');});};oAuthAdapter.getRequestToken('https://api.twitter.com/oauth/request_token',function(token){if(token){oAuthAdapter.showAuthorizeUI('https://api.twitter.com/oauth/authorize?'+token,receivePin);}});}};this._callApi=function(params){var match=params.url.match(/:[^\/\.]+/g);if(match){for(var i=0;i<match.length;i++){var index=match[i].replace(':','');if(params[index]){params.url=params.url.replace(match[i],params[index]);delete params[index];};};Ti.API.debug('replaced');Ti.API.debug(params);};var parameters=[];for(var index in params){if('url'==index)continue;if('method'==index)continue;if('onSuccess'==index)continue;if('onError'==index)continue;if('parameters'==index){for(var key in params.parameters){parameters.push([key,params.parameters[key]]);};continue;}
parameters.push([index,params[index]]);}
var oAuthAdapter=this.oAuthAdapter;oAuthAdapter.loadAccessToken('twitter');var response=oAuthAdapter.send({url:params.url,parameters:parameters,method:params.method,onSuccess:function(response){response=JSON.parse(response);if(params&&params.onSuccess){params.onSuccess(response);}else{Ti.API.error('no success handler');}},onError:function(error){if(params.onError){params.onError(error);}else{Ti.API.error('no error handler');Ti.API.error(error);}}});};this.callApi=function(params){if(!params){Ti.API.error('twitter api params error. no params.');return false;}
if(!params.url){Ti.API.error('twitter api params error. no params.url.');return false;};if(this.oAuthAdapter.isAuthorized()){return self._callApi(params);}else{setTimeout(function(){self.callApi(params);},1000);}};this.clear_accesstoken=function(){self.oAuthAdapter.clearAccessToken('twitter');};this.clear_actionsqueue=function(){self.oAuthAdapter.clearActionsQueue();};this.isAuthorized=function(){var oAuthAdapter=this.oAuthAdapter;oAuthAdapter.loadAccessToken('twitter');if(oAuthAdapter.isAuthorized()==false)
return false;else
return true;};this.statuses_public_timeline=function(params){params.url='https://api.twitter.com/1/statuses/public_timeline.json';params.method='GET';return self.callApi(params);};this.statuses_home_timeline=function(params){params.url='https://api.twitter.com/1/statuses/home_timeline.json';params.method='GET';return self.callApi(params);};this.statuses_friends_timeline=function(params){params.url='https://api.twitter.com/1/statuses/friends_timeline.json';params.method='GET';return self.callApi(params);};this.statuses_user_timeline=function(params){params.url='https://api.twitter.com/1/statuses/user_timeline.json';params.method='GET';return self.callApi(params);};this.statuses_mentions=function(params){params.url='https://api.twitter.com/1/statuses/mentions.json';params.method='GET';return self.callApi(params);};this.statuses_retweeted_by_me=function(params){params.url='https://api.twitter.com/1/statuses/retweeted_by_me.json';params.method='GET';return self.callApi(params);};this.statuses_retweeted_to_me=function(params){params.url='https://api.twitter.com/1/statuses/retweeted_to_me.json';params.method='GET';return self.callApi(params);};this.statuses_show=function(params){params.url='https://api.twitter.com/1/statuses/show/:id.json';params.method='GET';return self.callApi(params);};this.statuses_update=function(params){params.url='https://api.twitter.com/1/statuses/update.json';params.method='POST';return self.callApi(params);};this.statuses_destroy=function(params){params.url='https://api.twitter.com/1/statuses/destroy/:id.json';params.method='POST';return self.callApi(params);};this.statuses_retweet=function(params){params.url='https://api.twitter.com/1/statuses/retweet/:id.json';params.method='POST';return self.callApi(params);};this.statuses_retweets=function(params){params.url='https://api.twitter.com/1/statuses/retweets/:id.json';params.method='GET';return self.callApi(params);};this.statuses_retweeted_by=function(params){params.url='https://api.twitter.com/1/statuses/:id/retweeted_by.json';params.method='GET';return self.callApi(params);};this.statuses_retweeted_by_ids=function(params){params.url='https://api.twitter.com/1/statuses/:id/retweeted_by/:ids.json';params.method='GET';return self.callApi(params);};this.users_show=function(params){params.url='https://api.twitter.com/1/users/show.json';params.method='GET';return self.callApi(params);};this.users_lookup=function(params){params.url='https://api.twitter.com/1/users/lookup.json';params.method='GET';return self.callApi(params);};this.users_search=function(params){params.url='https://api.twitter.com/1/users/search.json';params.method='GET';return self.callApi(params);};this.users_suggestions=function(params){params.url='https://api.twitter.com/1/users/suggestions.json';params.method='GET';return self.callApi(params);};this.users_suggestions_twitter=function(params){params.url='https://api.twitter.com/1/users/suggestions/:slug.json';params.method='GET';return self.callApi(params);};this.users_profile_image_twitter=function(params){params.url='https://api.twitter.com/1/users/profile_image/:screen_name.json';params.method='GET';return self.callApi(params);};this.statuses_friends=function(params){params.url='https://api.twitter.com/1/statuses/friends.json';params.method='GET';return self.callApi(params);};this.statuses_followers=function(params){params.url='https://api.twitter.com/1/statuses/followers.json';params.method='GET';return self.callApi(params);};this.trends=function(params){params.url='https://api.twitter.com/1/trends.json';params.method='GET';return self.callApi(params);};this.trends_current=function(params){params.url='https://api.twitter.com/1/trends/current.json';params.method='GET';return self.callApi(params);};this.trends_daily=function(params){params.url='https://api.twitter.com/1/trends/daily.json';params.method='GET';return self.callApi(params);};this.trends_weekly=function(params){params.url='https://api.twitter.com/1/trends/weekly.json';params.method='GET';return self.callApi(params);};this.user_lists_create=function(params){params.url='https://api.twitter.com/1/:user/lists.json';params.method='POST';};this.user_lists_update=function(params){params.url='https://api.twitter.com/1/:user/lists/:id.json';params.method='POST';};this.user_lists_of_user=function(params){params.url='https://api.twitter.com/1/:user/lists.json';params.method='GET';};this.user_lists_get=function(params){params.url='https://api.twitter.com/1/:user/lists/:id.json';params.method='GET';};this.user_lists_delete=function(params){params.url='https://api.twitter.com/1/:user/lists/:id.json';params.method='POST';params._method='DELETE';};this.user_lists_statuses=function(params){params.url='https://api.twitter.com/1/:user/lists/:id/statuses.json';params.method='GET';};this.user_lists_memberships=function(params){params.url='https://api.twitter.com/1/:user/lists/memberships.json';params.method='GET';};this.user_lists_subscriptions=function(params){params.url='https://api.twitter.com/1/:user/lists/subscriptions.json';params.method='GET';};this.direct_messages=function(params){params.url='https://api.twitter.com/1/direct_messages.json';params.method='GET';return self.callApi(params);};this.direct_messages_sent=function(params){params.url='https://api.twitter.com/1/direct_messages/sent.json';params.method='GET';return self.callApi(params);};this.direct_messages_new=function(params){params.url='https://api.twitter.com/1/direct_messages/new.json';params.method='POST';return self.callApi(params);};this.friendships_create=function(params){params.url='https://api.twitter.com/1/friendships/create.json';params.method='GET';return self.callApi(params);};this.friendships_destroy=function(params){params.url='https://api.twitter.com/1/friendships/destroy/:id.json';params.method='GET';return self.callApi(params);};this.friendships_exists=function(params){params.url='https://api.twitter.com/1/friendships/exists.json';params.method='GET';return self.callApi(params);};this.friendships_show=function(params){params.url='https://api.twitter.com/1/friendships/show.json';params.method='GET';return self.callApi(params);};this.friendships_incoming=function(params){params.url='https://api.twitter.com/1/friendships/incoming.json';params.method='GET';return self.callApi(params);};this.account_verify_credentials=function(params){params.url='https://api.twitter.com/1/account/verify_credentials.json';params.method='GET';return self.callApi(params);};this.account_rate_limit_status=function(params){params.url='https://api.twitter.com/1/account/rate_limit_status.json';params.method='GET';return self.callApi(params);};this.account_end_session=function(params){params.url='https://api.twitter.com/1/account/end_session.json';params.method='POST';return self.callApi(params);};this.account_update_delivery_device=function(params){params.url='https://api.twitter.com/1/account/update_delivery_device.json';params.method='POST';return self.callApi(params);};this.account_update_profile_colors=function(params){params.url='https://api.twitter.com/1/account/update_profile_colors.json';params.method='POST';return self.callApi(params);};this.account_update_profile_image=function(params){params.url='https://api.twitter.com/1/account/update_profile_image.json';params.method='POST';return self.callApi(params);};this.account_update_profile_background_image=function(params){params.url='https://api.twitter.com/1/account/update_profile_background_image.json';params.method='POST';return self.callApi(params);};this.favorites=function(params){params.url='https://api.twitter.com/1/favorites.json';params.method='GET';return self.callApi(params);};this.favorites_create=function(params){params.url='https://api.twitter.com/1/favorites/create/:id.json';params.method='POST';return self.callApi(params);};this.favorites_destroy=function(params){params.url='https://api.twitter.com/1/favorites/destroy:id.json';params.method='POST';return self.callApi(params);};this.blocks_create=function(params){params.url='https://api.twitter.com/1/blocks/create.json';params.method='POST';return self.callApi(params);};this.blocks_destroy=function(params){params.url='https://api.twitter.com/1/blocks/destroy.json';params.method='POST';return self.callApi(params);};this.blocks_exists=function(params){params.url='https://api.twitter.com/1/blocks/exists.json';params.method='GET';return self.callApi(params);};this.blocks_blocking=function(params){params.url='https://api.twitter.com/1/blocks/blocking.json';params.method='GET';return self.callApi(params);};this.blocks_blocking_ids=function(params){params.url='https://api.twitter.com/1/blocks/blocking/:ids.json';params.method='GET';return self.callApi(params);};this.report_spam=function(params){params.url='https://api.twitter.com/1/report_spam.json';params.method='POST';return self.callApi(params);};this.saved_searches=function(params){params.url='https://api.twitter.com/1/saved_searches.json';params.method='GET';return self.callApi(params);};this.saved_searches_show=function(params){params.url='https://api.twitter.com/1/saved_searches/show.json';params.method='GET';return self.callApi(params);};this.saved_searches_create=function(params){params.url='https://api.twitter.com/1/saved_searches/create.json';params.method='POST';return self.callApi(params);};this.saved_searches_delete=function(params){params.url='https://api.twitter.com/1/saved_searches/destroy.json';params.method='POST';return self.callApi(params);};this.geo_search=function(params){params.url='https://api.twitter.com/1/geo/search.json';params.method='GET';return self.callApi(params);};this.geo_similar_places=function(params){params.url='https://api.twitter.com/1/geo/similar_places.json';params.method='GET';return self.callApi(params);};this.geo_reverse_geocode=function(params){params.url='https://api.twitter.com/1/geo/reverse_geocode.json';params.method='GET';return self.callApi(params);};this.geo_id_place=function(params){params.url='https://api.twitter.com/1/geo/id/:place_id.json';params.method='GET';return self.callApi(params);};};