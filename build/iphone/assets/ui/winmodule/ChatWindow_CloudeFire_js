function ChatWindow(tabbed_window,show_navbar,title,name){var cdk=require('com.infinery.cdk');var dynapp;var cloudebug;var cloudefire;var cloudecache;if(Ti.Platform.osname=='android')
{dynapp=cdk.dynapp;cloudebug=cdk.cloudebug;cloudefire=cdk.cloudefire;cloudecache=cdk.cloudecache;}
else
{dynapp=cdk;cloudebug=cdk;cloudefire=cdk;cloudecache=cdk;}
var pos_msgbox=10;var clt=cdk.create('b9251ccb-b522-4457-9519-5e699d9d27e8');clt.register({connected:function(e){clt.write('info','connected from Taipei');clt.addEventListener('update','apple',{secure:false},function(e){var jsondata=JSON.stringify(e)
alert('updates are available: '+jsondata);textArea.recieveMessage(jsondata);});}});var SMSView=require('ti.smsview');var buttonBar=Ti.UI.createButtonBar({labels:['Recieve','Empty','Get All','Disable','Enable'],height:30,style:Ti.UI.iPhone.SystemButtonStyle.BAR});var headerView=Ti.UI.createView();headerView.add(buttonBar);var win=Ti.UI.createWindow({orientationModes:[1,2,3,4]});var textArea=SMSView.createView({backgroundColor:'#dae1eb',returnType:SMSView.RETURNKEY_DONE,camButton:true,hasTab:true});win.add(textArea);buttonBar.addEventListener('click',function(e){switch(e.index){case 0:textArea.recieveMessage('Hello World!');break;case 1:textArea.empty();break;case 2:Ti.API.info(textArea.getAllMessages());break;case 3:textArea.sendButtonDisabled=true;break;case 4:textArea.sendButtonDisabled=false;break;}});textArea.addEventListener('click',function(e){if(e.scrollView){textArea.blur();}
Ti.API.info('Clicked on the scrollview');});textArea.addEventListener('buttonClicked',function(e){textArea.addLabel(new Date()+"");textArea.sendMessage(e.value);clt.fire('update','apple',{secure:false,maxSubscribers:10},{msgtext:'Hello World'})});textArea.addEventListener('camButtonClicked',function(){var options=Ti.UI.createOptionDialog({options:['Photo Gallery','Cancel'],cancel:1,title:'Send a photo'});options.show();options.addEventListener('click',function(e){if(e.index==0){Ti.Media.openPhotoGallery({success:function(event){var image=Ti.UI.createImageView({image:event.media});image.width=100;image.height=(100/event.media.width)*event.media.height
textArea.sendMessage(image.toBlob());},mediaTypes:[Ti.Media.MEDIA_TYPE_PHOTO]});}});});textArea.addEventListener('change',function(e){Ti.API.info(e.value);});textArea.addEventListener('messageClicked',function(e){if(e.text){Ti.API.info('Text: '+e.text);}
if(e.image){Ti.API.info('Image: '+e.image);}
Ti.API.info('Index: '+e.index);});win.navBarHidden=true;return win};module.exports=ChatWindow;